<app-header-admin-empresa></app-header-admin-empresa>
<div class="container mt-4">
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">
        <i class="fas fa-chart-bar me-2"></i>Generador de Reportes de Empresa
      </h4>
    </div>
    
    <div class="card-body">
      <!-- Información de empresa del usuario -->
      <div *ngIf="idEmpresaUsuario" class="alert alert-success mb-4" role="alert">
        <div class="d-flex align-items-center">
          <i class="fas fa-building fa-2x me-3"></i>
          <div>
            <h5 class="alert-heading mb-1">{{ nombreEmpresaUsuario }}</h5>
            <p class="mb-0">Generando reportes para tu empresa (ID: {{ idEmpresaUsuario }})</p>
          </div>
        </div>
      </div>
      
      <!-- Mensaje si no tiene empresa -->
      <div *ngIf="!idEmpresaUsuario" class="alert alert-danger mb-4" role="alert">
        <div class="d-flex align-items-center">
          <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
          <div>
            <h5 class="alert-heading mb-1">Empresa no encontrada</h5>
            <p class="mb-0">No tienes una empresa asignada. Contacta al administrador del sistema.</p>
          </div>
        </div>
      </div>
      
      <!-- FORM GROUP (solo si tiene empresa) -->
      <form [formGroup]="formularioReporte" *ngIf="idEmpresaUsuario">
        
        <!-- Selección de Tipo de Reporte -->
        <div class="row mb-4">
          <div class="col-12">
            <h5 class="mb-3 text-dark">Seleccione el tipo de reporte:</h5>
            <div class="row">
              <div class="col-md-4 mb-3" *ngFor="let tipo of tiposReporte">
                <div class="card reporte-card h-100" 
                     [class.selected]="reporteSeleccionado === tipo.id"
                     (click)="seleccionarReporte(tipo.id)">
                  <div class="card-body text-center">
                    <i class="fas {{tipo.icono}} fa-2x mb-2 text-primary"></i>
                    <h6 class="card-title mb-1">{{tipo.nombre}}</h6>
                    <p class="card-text small text-muted">{{tipo.descripcion}}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Checkbox para activar/desactivar fechas -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" 
                     id="usarFechas" formControlName="usarFechas"
                     style="width: 3em; height: 1.5em;">
              <label class="form-check-label ms-2 fw-bold" for="usarFechas">
                Filtrar por rango de fechas
              </label>
              <div class="form-text mt-1">
                <span *ngIf="!usarFechas" class="text-success">
                  <i class="fas fa-check-circle me-1"></i>Reporte histórico completo
                </span>
                <span *ngIf="usarFechas" class="text-info">
                  <i class="fas fa-calendar-alt me-1"></i>Reporte por período específico
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Filtros de Fecha (solo si está activado) -->
        <div class="row mb-4" *ngIf="usarFechas">
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Fecha Inicio</label>
            <input type="date" class="form-control" 
                   formControlName="fechaInicio"
                   [required]="usarFechas">
            <div class="form-text">Seleccione la fecha inicial del período</div>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Fecha Fin</label>
            <input type="date" class="form-control" 
                   formControlName="fechaFin"
                   [required]="usarFechas">
            <div class="form-text">Seleccione la fecha final del período</div>
          </div>
        </div>

        <!-- Botones de Acción -->
        <div class="row mt-4">
          <div class="col-12 d-flex justify-content-between">
            <button type="button" class="btn btn-outline-secondary px-4" 
                    (click)="limpiarFiltros()"
                    [disabled]="cargando">
              <i class="fas fa-redo me-2"></i>Limpiar Filtros
            </button>
            
            <button type="button" class="btn btn-primary px-4" 
                    (click)="generarReporte()"
                    [disabled]="cargando || !puedeGenerarReporte">
              <span *ngIf="!cargando">
                <i class="fas fa-file-download me-2"></i>Generar Reporte
              </span>
              <span *ngIf="cargando">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Procesando...
              </span>
            </button>
          </div>
        </div>

      </form> <!-- CIERRA EL FORM -->

      <!-- Información -->
      <div class="alert alert-light mt-4" role="alert">
        <div class="d-flex">
          <i class="fas fa-question-circle fa-2x me-3 align-self-start mt-1 text-primary"></i>
          <div>
            <h5 class="alert-heading mb-2">Acerca de los Reportes de Empresa</h5>
            
            <div class="mb-3">
              <h6><i class="fas fa-trophy me-2"></i>Top 5 Juegos Más Vendidos</h6>
              <p class="mb-2 small">Muestra los 5 juegos más populares de tu empresa basados en el número de ventas.</p>
              <ul class="small">
                <li>Ranking por cantidad de ventas</li>
                <li>Incluye estadísticas generales</li>
                <li>Porcentaje del top 5 respecto al total</li>
              </ul>
            </div>
            
            <div class="mb-3">
              <h6><i class="fas fa-chart-line me-2"></i>Ventas Propias</h6>
              <p class="mb-2 small">Reporte detallado de todas las ventas de tu empresa, incluyendo ingresos y comisiones.</p>
              <ul class="small">
                <li>Ventas por videojuego</li>
                <li>Ingresos brutos y netos</li>
                <li>Cálculo de comisiones</li>
              </ul>
            </div>
            
            <hr>
            <p class="mb-0 small">
              <i class="fas fa-exclamation-triangle me-1 text-warning"></i>
              La generación del PDF puede tardar unos segundos dependiendo de la cantidad de datos.
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card-footer text-muted small">
      <div class="d-flex justify-content-between align-items-center">
        <span>
          <i class="fas fa-building me-1"></i>
          Reportes Específicos de Empresa
        </span>
        <span>
          <i class="fas fa-calendar-alt me-1"></i>
          {{ fechaActual | date:'dd/MM/yyyy HH:mm' }}
        </span>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>